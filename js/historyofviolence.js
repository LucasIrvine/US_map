$(function(){function t(t){t&&null==C.active_conflict?g=t.country.conflict_region:null==t&&(g=null),e()}function n(t){g=t,e()}function r(){n(null)}function e(t){var n={c:g,year:h};x.html(b(n)),V.bounds(g),t||(T.html(k(n)),g&&initialize_minimap(g))}function a(t){var n;t?D=n=C.g_points.selectAll("circle.conflict-dot").data(C.conflict_regions).enter().append("circle").attr("transform",function(t){var n=C.projection([t.lon,t.lat]);return"translate("+n[0]+","+n[1]+")"}).attr("stroke-width",c).attr("class","conflict-dot").on("click",function(t){C.click_conflict(t)}):n=D.transition().duration(500),n.attr("r",function(t){var n=t.year?t.year[h]:void 0;return t.inner_radius=n>=1?S(n):0,o(t)}),C.g_points.selectAll("circle").classed("inactive",function(t){return t.year_end&&h>t.year_end}).classed("disabled",function(t){return t.year_start&&t.year_start>h})}function i(){F.attr("r",s).attr("stroke-width",l),D.attr("r",o),M.attr("r",u)}function c(){return 1.5/C.scale}function o(t){return t.inner_radius/C.scale}function l(){return 2/C.scale}function s(t){return t.outer_radius/C.scale}function u(t){return t.marker_radius/C.scale}function d(){(new Image).src="//d2hutign5qda4l.cloudfront.net/assets/wbc/pause-button-24f5c15c588b1eff395bb68747a4f5f6.png"}function f(t){var n=10;E.x=0,E.y=0;var r=E.matrixTransform(B.getScreenCTM());E.x=n;var e=E.matrixTransform(B.getScreenCTM()),a=e.x-r.x,i=a/n;U.transition().duration(t?400:0).attr("width",P*i),G.range(_.map(A,function(t){return(t+y)*i})),W.transition().duration(t?400:0).call(I)}var m=1947,p=2010,h=1947,g=null,v=$("html").hasClass("touch"),y=v?16:8,b=_.template($("#sideColUlTemplate").html()),k=_.template($("#sideColDescriptionTemplate").html()),w=$(".sideCol > .tab1"),x=w.children("ul"),T=w.children(".description"),C=(new initialize_map).country_select(t).country_deselect(r).conflict_select(n).on_zoom(i).on_ready(d);_.flatten(_.map(C.conflict_regions,function(t){return _.values(t.year)}));var z=[0,1e5],A=[0,150],j=[0,1e4,4e4,1e5],S=d3.scale.linear().domain(z).range(_.map(A,function(t){return t+y})),q=_.filter(C.conflict_regions,function(t){return t.total_sum>500}),F=C.g_points.selectAll("circle.conflict-outer").data(q).enter().append("circle").attr("r",function(t){return t.outer_radius=S(t.total_sum),s(t)}).attr("transform",function(t){var n=C.projection([t.lon,t.lat]);return"translate("+n[0]+","+n[1]+")"}).attr("stroke-width",l).attr("class","conflict-outer"),M=C.g_points.selectAll("circle.conflict-marker").data(C.conflict_regions).enter().append("circle").attr("r",function(t){return t.marker_radius=y,u(t)}).attr("transform",function(t){var n=C.projection([t.lon,t.lat]);return"translate("+n[0]+","+n[1]+")"}).attr("class","conflict-marker").on("click",function(t){C.click_conflict(t)}),N=$("#sncTotalNumber"),V=new Timeline("#timelineContainer",m,p,h,64,510,!0,970,function(){h=this.selected_year,e(!0),a(),N.html(add_commas(app.tab_data.years[h]))});V.slider.append("image").attr("height",66).attr("width",47).attr("y",0).attr("xlink:href","//d2hutign5qda4l.cloudfront.net/assets/wbc/timeline-scroll-fa1a1518d21be5afbdfe7a0070179ffc.png").attr("x",-23.5),N.html(add_commas(app.tab_data.years[h]));var D;n(null),a(!0);var G=d3.scale.linear().domain(z).range(_.map(A,function(t){return t+y})),I=d3.svg.axis().orient("top").scale(G).tickValues(j).tickFormat(function(t){return t/1e3}),P=180,U=d3.select("#scaleWrapper").append("svg:svg").attr("width",P).attr("height",25),W=U.append("svg:g").attr("class","x axis").attr("transform","translate(0,20)").call(I);$(window).resize(_.throttle(function(){f(!0)},401)),$(".legend");var B=C.svg[0][0],E=B.createSVGPoint();f(!1)}),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};